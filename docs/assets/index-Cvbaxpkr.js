import{j as e,r as u}from"./react-DHBI0EtI.js";import{c as De}from"./react-dom-m0Soxutk.js";import{B as Se}from"./react-router-dom-C2IQ_L4I.js";import{u as ie}from"./react-hook-form-TA_W7sgq.js";import{o as R}from"./mobx-react-lite-m5mAWZBZ.js";import{a as K,r as Z}from"./mobx-uTECe87D.js";import{a as S}from"./axios-CCb-kr4I.js";import{C as T,B as I,P as oe,a as C,T as d,b as N,I as ne,c as L,V as ae,d as le,e as ce,L as de,f as Ie,g as he,h as ke,i as _e,A as ve,j as Le,F as Be,k as Ae,S as Te,M as q,l as Fe,N as ee,E as Pe,D as Ee,m as me,n as $e,o as Me,p as qe,q as Oe,r as ze,s as Ne,t as Re}from"./@mui-B_p6gauv.js";import{u as _,a as W,b as We,c as D}from"./react-router-DeS6GNwm.js";import{F as m,M as ue,I as w,S as b,U as pe,B as k,D as Ue,C as Ve,T as He,a as Ge}from"./antd-BZ9Wb0G4.js";import{T as ge}from"./@ant-design-D5eOVOcB.js";import"./classnames-C9FZUsQl.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-Cz6oGz3K.js";import"./use-sync-external-store-U2Sg9eXX.js";import"./react-is-DcfIKM1A.js";import"./@emotion-Su2HbLT9.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./@babel-BtPi2XIt.js";import"./stylis-YPZU7XtI.js";import"./clsx-B-dksMZM.js";import"./react-transition-group-BZCvRTj2.js";import"./rc-util-C-ojZSMc.js";import"./rc-resize-observer-Dks0eWPk.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-CcFStZqK.js";import"./@rc-component-DfeRbotr.js";import"./rc-overflow-Bujk3lLu.js";import"./rc-menu-vc2km0h8.js";import"./rc-select-D-y57sOE.js";import"./rc-virtual-list-IqqFrh-p.js";import"./rc-drawer-BNnyi9em.js";import"./rc-field-form-CS_bMUnA.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-dialog-CfOQNX7d.js";import"./rc-table-Hs4OUqHL.js";import"./rc-tree-DhyT1hpS.js";import"./rc-checkbox-BW0H7KXh.js";import"./rc-dropdown-B2dlau0p.js";import"./@ctrl-DOFZgDuz.js";import"./rc-pagination-CilJmSr7.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-input-BHSlWDXb.js";import"./rc-textarea-_T4_NVPF.js";import"./rc-upload-Clc7D8kH.js";import"./rc-picker-BH4iOX9v.js";import"./rc-progress-CqLWRIDz.js";import"./rc-tooltip-Bl6SRsnU.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();const B={drills:"drills",drill:"drill",createDrill:"drill/create",updateDrill:"drill/update/",deleteDrill:"drill/delete/",archive_drills:"archive_drills",archive_drill:"archive_drill",screws:"screws",screw:"screw",plates:"plates",plate:"plate",register:"auth/register",login:"auth/jwt/login"};class Ke{constructor(){this.isLoading=!1,this.error="",this.email=localStorage.getItem("authEmail")||"",this.isAuthenticated=!!this.email,K(this)}async register(t,s){var i,o;this.setLoading(!0),this.setError("");try{await S.post(`https://gas159.ru/api/${B.register}`,{email:t,password:s}),this.isAuthenticated=!0}catch(n){this.setError(((o=(i=n.response)==null?void 0:i.data)==null?void 0:o.detail)||"Произошла ошибка регистрации")}finally{this.setLoading(!1)}}async login(t,s){var i,o;this.setLoading(!0),this.setError("");try{await S.post(`https://gas159.ru/api/${B.login}`,{username:t,password:s},{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}),this.setEmail(t),this.isAuthenticated=!0}catch(n){this.setError(((o=(i=n.response)==null?void 0:i.data)==null?void 0:o.detail)||"Произошла ошибка входа")}finally{this.setLoading(!1)}}logout(){this.isAuthenticated=!1,localStorage.removeItem("authEmail")}setLoading(t){this.isLoading=t}setError(t){this.error=t}setEmail(t){this.email=t,localStorage.setItem("authEmail",t)}}const x=new Ke,Je=()=>{const[r,t]=u.useState(!1),{register:s,handleSubmit:i,formState:{errors:o}}=ie(),n=()=>t(c=>!c),a=c=>{c.preventDefault()},p=()=>{l("/")},l=_();return{register:s,handleSubmit:i,errors:o,showPassword:r,handleClickShowPassword:n,handleMouseDownPassword:a,handleBack:p,onSubmit:async c=>{await x.login(c.email,c.password),x.error||l("/")},navigate:l}},te={"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#000"}},"& .MuiInputLabel-root":{"&.Mui-focused":{color:"#000"}}},Qe=R(()=>{const{register:r,handleSubmit:t,errors:s,showPassword:i,handleClickShowPassword:o,handleMouseDownPassword:n,handleBack:a,onSubmit:p,navigate:l}=Je();return e.jsxs(T,{component:"main",maxWidth:"xs",sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh"},children:[e.jsx(I,{onClick:a,sx:{marginBottom:4},children:"Назад"}),e.jsx(oe,{elevation:3,sx:{padding:4,width:"100%"},children:e.jsxs(C,{component:"form",onSubmit:t(p),children:[e.jsx(d,{variant:"h4",gutterBottom:!0,align:"center",children:"Авторизация"}),e.jsx(N,{label:"Email",...r("email",{required:"Введите email"}),error:!!s.email,helperText:s.email?String(s.email.message):"",fullWidth:!0,margin:"normal",sx:te}),e.jsx(N,{label:"Пароль",type:i?"text":"password",...r("password",{required:"Введите пароль"}),error:!!s.password,helperText:s.password?String(s.password.message):"",fullWidth:!0,margin:"normal",sx:te,InputProps:{endAdornment:e.jsx(ne,{position:"end",children:e.jsx(L,{"aria-label":"toggle password visibility",onClick:o,onMouseDown:n,edge:"end",children:i?e.jsx(ae,{}):e.jsx(le,{})})})}}),e.jsx(I,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:2,borderRadius:"20px",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},disabled:x.isLoading,children:x.isLoading?e.jsx(ce,{size:24,sx:{color:"white"}}):"Войти"}),x.error&&e.jsx(d,{color:"error",align:"center",sx:{mt:2},children:x.error}),e.jsxs(d,{variant:"body2",align:"center",sx:{mt:2},children:["Нет аккаунта?"," ",e.jsx(de,{onClick:()=>l("/register"),sx:{textDecoration:"none",cursor:"pointer"},children:"Регистрация"})]})]})})]})}),Xe=()=>{const[r,t]=u.useState(!1),{register:s,handleSubmit:i,formState:{errors:o}}=ie(),n=()=>t(c=>!c),a=c=>{c.preventDefault()},p=()=>{l("/")},l=_();return{register:s,handleSubmit:i,errors:o,showPassword:r,handleClickShowPassword:n,handleMouseDownPassword:a,handleBack:p,onSubmit:async c=>{await x.register(c.email,c.password),x.error||l("/login")},navigate:l}},se={"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#000"}},"& .MuiInputLabel-root":{"&.Mui-focused":{color:"#000"}}},Ye=R(()=>{const{register:r,handleSubmit:t,errors:s,showPassword:i,handleClickShowPassword:o,handleMouseDownPassword:n,handleBack:a,onSubmit:p,navigate:l}=Xe();return e.jsxs(T,{component:"main",maxWidth:"xs",sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh"},children:[e.jsx(I,{onClick:a,sx:{marginBottom:4},children:"Назад"}),e.jsx(oe,{elevation:3,sx:{padding:4,width:"100%"},children:e.jsxs(C,{component:"form",onSubmit:t(p),children:[e.jsx(d,{variant:"h4",gutterBottom:!0,align:"center",children:"Регистрация"}),e.jsx(N,{label:"Email",...r("email",{required:"Введите email"}),error:!!s.email,helperText:s.email?String(s.email.message):"",fullWidth:!0,margin:"normal",sx:se}),e.jsx(N,{label:"Пароль",type:i?"text":"password",...r("password",{required:"Введите пароль"}),error:!!s.password,helperText:s.password?String(s.password.message):"",fullWidth:!0,margin:"normal",sx:se,InputProps:{endAdornment:e.jsx(ne,{position:"end",children:e.jsx(L,{"aria-label":"toggle password visibility",onClick:o,onMouseDown:n,edge:"end",children:i?e.jsx(ae,{}):e.jsx(le,{})})})}}),e.jsx(I,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:2,borderRadius:"20px",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},disabled:x.isLoading,children:x.isLoading?e.jsx(ce,{size:24,sx:{color:"white"}}):"Регистрация"}),x.error&&e.jsx(d,{color:"error",align:"center",sx:{mt:2},children:x.error}),e.jsxs(d,{variant:"body2",align:"center",sx:{mt:2},children:["Уже есть аккаунт?"," ",e.jsx(de,{onClick:()=>l("/login"),sx:{textDecoration:"none",cursor:"pointer"},children:"Войти"})]})]})})]})}),re={palette:{primary:Ie}},Ze=()=>{const r=localStorage.getItem("colorTheme"),[t,s]=u.useState(r||"light"),i=()=>{s(n=>{const a=n==="light"?"dark":"light";return localStorage.setItem("colorTheme",a),a})};return{theme:u.useMemo(()=>he({...re,palette:{...re.palette,mode:t}}),[t]),mode:t,toggleColorMode:i}},xe=u.createContext({mode:"light",toggleColorMode:()=>{},theme:he()}),et=({children:r})=>{const t=Ze();return e.jsxs(xe.Provider,{value:t,children:[" ",r," "]})},F=()=>u.useContext(xe),tt=()=>{const{mode:r,toggleColorMode:t}=F();return e.jsx(C,{children:e.jsx(L,{sx:{ml:1},onClick:t,color:"inherit",children:r==="dark"?e.jsx(ke,{}):e.jsx(_e,{})})})},je=()=>(u.useEffect(()=>{const r=localStorage.getItem("authEmail");r&&(x.isAuthenticated=!0,x.email=r)},[]),{isAuthenticated:x.isAuthenticated,email:x.email,login:x.login.bind(x),logout:x.logout.bind(x),register:x.register.bind(x)}),J=()=>{const r=_(),{isAuthenticated:t}=je(),s=()=>{r("/login")},i=()=>{r("/account")},o=()=>{r("/")};return e.jsx(ve,{position:"static",color:"primary",children:e.jsxs(Le,{children:[e.jsx(d,{variant:"h6",component:"p",onClick:o,sx:{flexGrow:1,cursor:"pointer"},children:"Tool Manager"}),e.jsx(tt,{}),t?e.jsx(I,{onClick:i,sx:{color:"white"},children:"Личный кабинет"}):e.jsx(I,{onClick:s,sx:{color:"white"},children:"Login"})]})})},fe=()=>{const[r,t]=u.useState(""),s=_(),i=W().pathname.slice(1);u.useEffect(()=>{t(i||"")},[i]);const o=n=>{const a=n.target.value;t(a)};return e.jsx(e.Fragment,{children:e.jsxs(Be,{fullWidth:!0,variant:"outlined",sx:{width:"200px",m:"10px"},children:[e.jsx(Ae,{id:"tools-dropdown-label",children:"Инструменты"}),e.jsxs(Te,{labelId:"tools-dropdown-label",value:r,onChange:o,label:"Инструменты",children:[e.jsx(q,{value:"drills",onClick:()=>s("/drills"),children:"Сверла"}),e.jsx(q,{value:"screws",onClick:()=>s("/screws"),children:"Винты"}),e.jsx(q,{value:"plates",onClick:()=>s("/plates"),children:"Пластины"}),e.jsx(q,{value:"archive_drills",onClick:()=>s("/archive_drills"),children:"Архив"})]})]})})},st=()=>e.jsxs(e.Fragment,{children:[e.jsx(J,{}),e.jsx(fe,{})]}),$=async(r="")=>{try{const t=r==="drills"?`?broken=${j.isBroken}`:"";return(await S.get(`https://gas159.ru/api/${r}${t}`)).data}catch(t){console.log(t)}},ye=async(r,t)=>{try{return(await S.get(`https://gas159.ru/api/${B[t]}/${r}`)).data}catch(s){console.log(s)}},rt=async r=>{const t=new FormData,s={name:r.name,diameter:Number(r.diameter),length_xD:Number(r.length_xD),deep_of_drill:Number(r.deep_of_drill),key:r.key,company:r.company,is_broken:r.is_broken,storage:r.storage,description:r.description};t.append("drill",JSON.stringify(s)),t.append("screws_ids",String([r.screws])),t.append("plates_ids",String([r.plates])),r.images&&r.images.length>0&&r.images.forEach(i=>{const o=i,n=o.originFileObj||o;t.append("images",n)});try{const i=await S.post(`https://gas159.ru/api/${B.createDrill}`,t,{headers:{"Content-Type":"multipart/form-data"}});return console.log("Форма успешно отправлена!"),console.log(i),{message:"Форма успешно отправлена!"}}catch(i){throw console.error("Возникла ошибка при отправке формы:",i),i}},it=async(r,t)=>{console.log(t.images);const s=new FormData,i={name:t.name,diameter:Number(t.diameter),length_xD:Number(t.length_xD),deep_of_drill:Number(t.deep_of_drill),key:t.key,company:t.company,is_broken:t.is_broken,storage:t.storage,description:t.description};s.append("drill",JSON.stringify(i)),s.append("screws_ids",String([t.screws])),s.append("plates_ids",String([t.plates]));const o=async(n,a,p)=>{const f=await(await fetch(n)).blob();return new File([f],a,{type:p})};if(t.images&&t.images.length>0){const n=t.images.filter(l=>!l.originFileObj).map(l=>{const f=l;return o(f.url,f.name,"image/png")}),a=t.images.filter(l=>l.originFileObj);(await Promise.all(n)).forEach(l=>{s.append("images",l)}),a.forEach(l=>{const f=l;s.append("images",f.originFileObj)})}try{const n=await S.put(`https://gas159.ru/api/${B.updateDrill}${r}`,s,{headers:{"Content-Type":"multipart/form-data"}});return console.log("Данные успешно обновлены!"),console.log(n),{message:"Данные успешно обновлены!"}}catch(n){throw console.error("Возникла ошибка при обновлении данных:",n),n}},ot=async(r,t)=>{try{const s={headers:{"Content-Type":"application/json"}},i=await S.delete(`https://gas159.ru/api/${B[t]}${r}`,s);return j.getDetails(t),i.data}catch(s){console.log(s)}};class nt{constructor(){this.details=[],this.isError=!1,this.isBroken=!1,this.idDetailEdit=null,this.idDetailDescription=null,K(this,{},{autoBind:!0})}async getDetails(t){this.isError=!1;try{const s=await $(B[t]);Z(()=>{this.details=s,this.details.length>0&&(this.idDetailDescription=this.details[0].id)})}catch(s){Z(()=>{this.isError=!0}),console.error("Failed to fetch drills:",s)}}getDetailsParameters(t){switch(t){case"drills":return this.getDiameters();case"screws":return this.getScrewsLength();case"plates":return this.getPlatesAmount();case"archive_drills":return this.getDiameters()}}getDiameters(){if(!this.details||!this.details.length)return[];const t=this.details.map(s=>s.diameter);return Array.from(new Set(t)).sort((s,i)=>s-i)}getScrewsLength(){return!this.details||!this.details.length?[]:Array.from(new Set(this.details.map(t=>t.length))).sort((t,s)=>t-s)}getPlatesAmount(){return!this.details||!this.details.length?[]:Array.from(new Set(this.details.map(t=>t.amount))).sort((t,s)=>t-s)}handleIsBroken(){this.isBroken=!this.isBroken,this.getDetails("drills")}getDetailIdEdit(t){this.idDetailEdit=t}getDetailIdDescription(t){this.idDetailDescription=t}}const j=new nt,at=({id:r,visible:t,onClose:s,activeItem:i})=>{const[o]=m.useForm(),[n,a]=u.useState([]),[p,l]=u.useState([]),[f,c]=u.useState([]),[g,y]=u.useState(!1),v={labelCol:{span:6},wrapperCol:{span:16}},M={wrapperCol:{offset:6,span:16}};u.useEffect(()=>{(async()=>{if(r&&t){const A=await ye(r,i.slice(0,-1));if(A){o.setFieldsValue({...A,screws:A.screws.map(E=>E.id)||[],plates:A.plates.map(E=>E.id)||[]});const Ce=A.image_path?A.image_path.split(",").map((E,Y)=>({uid:Y,name:`image-${Y}`,status:"done",url:`https://gas159.ru/api/${E.trim()}`})):[];a(Ce)}}const P=await $("screws");l(P);const be=await $("plates");c(be)})()},[r,t,o,i]);const U=({fileList:h})=>{a(h)},V=async h=>{y(!0);try{h.images=n,await it(r,h),j.getDetails("drills"),s()}catch(P){console.error("Ошибка при обновлении данных:",P)}finally{y(!1)}};return e.jsx(ue,{title:"Редактирование сверла",open:t,footer:null,onCancel:s,children:e.jsxs(m,{form:o,onFinish:V,...v,initialValues:{screws:[],plates:[],images:[]},children:[e.jsx(m.Item,{label:"Название",name:"name",rules:[{required:!0,message:"Пожалуйста, введите название!"}],children:e.jsx(w,{placeholder:"Пожалуйста, введите название"})}),e.jsx(m.Item,{label:"Диаметр",name:"diameter",rules:[{required:!0,message:"Пожалуйста, введите диаметр!"}],children:e.jsx(w,{type:"number",placeholder:"Пожалуйста, введите диаметр"})}),e.jsx(m.Item,{label:"Длина",name:"length_xD",rules:[{required:!0,message:"Пожалуйста, введите длину!"}],children:e.jsx(w,{type:"number",placeholder:"Пожалуйста, введите длину"})}),e.jsx(m.Item,{label:"Глубина сверления",name:"deep_of_drill",rules:[{required:!0,message:"Пожалуйста, введите глубину сверления!"}],children:e.jsx(w,{type:"number",placeholder:"Пожалуйста, введите глубину сверления"})}),e.jsx(m.Item,{label:"Ключ",name:"key",rules:[{required:!0,message:"Пожалуйста, введите название ключа!"}],children:e.jsx(w,{placeholder:"Пожалуйста, введите название ключа"})}),e.jsx(m.Item,{label:"Компания",name:"company",rules:[{required:!0,message:"Пожалуйста, введите название компании!"}],children:e.jsx(w,{placeholder:"Пожалуйста, введите название компании"})}),e.jsx(m.Item,{label:"Состояние",name:"is_broken",rules:[{required:!0,message:"Пожалуйста, выберите состояние!"}],children:e.jsxs(b,{style:{width:"100%"},children:[e.jsx(b.Option,{value:!1,children:"Исправно"}),e.jsx(b.Option,{value:!0,children:"Сломанно"})]})}),e.jsx(m.Item,{label:"Винты",name:"screws",rules:[{required:!0,message:"Пожалуйста, выберите винт!"}],children:e.jsx(b,{mode:"multiple",style:{width:"100%"},placeholder:"Выберите винт...",children:p.map(h=>e.jsx(b.Option,{value:h.id,children:h.type},h.id))})}),e.jsx(m.Item,{label:"Пластины",name:"plates",rules:[{required:!0,message:"Пожалуйста, выберите пластину!"}],children:e.jsx(b,{mode:"multiple",style:{width:"100%"},placeholder:"Выберите пластину...",children:f.map(h=>e.jsx(b.Option,{value:h.id,children:h.type},h.id))})}),e.jsx(m.Item,{label:"Место хранения",name:"storage",rules:[{required:!0,message:"Пожалуйста, выберите место хранения!"}],children:e.jsx(w,{placeholder:"Пожалуйста, выберите место хранения"})}),e.jsx(m.Item,{label:"Изображение",name:"images",children:e.jsx(pe,{fileList:n,onChange:U,beforeUpload:()=>!1,children:e.jsx(k,{icon:e.jsx(ge,{}),children:"Нажмите, чтобы загрузить"})})}),e.jsx(m.Item,{label:"Описание",name:"description",rules:[{required:!0,message:"Пожалуйста, предоставьте описание!"}],children:e.jsx(w.TextArea,{rows:4,placeholder:"Пожалуйста, введите подробное описание"})}),e.jsx(m.Item,{...M,children:e.jsx(k,{type:"primary",htmlType:"submit",loading:g,children:"Сохранить изменения"})})]})})},lt={labelCol:{span:6},wrapperCol:{span:16}},ct={wrapperCol:{offset:6,span:16}};function dt({onSubmit:r,onSuccess:t}){const[s,i]=u.useState([]),[o,n]=u.useState([]),[a,p]=u.useState([]),l=({fileList:g})=>{p(g)};u.useEffect(()=>{const g=async()=>{const v=await $("screws");i(v)};(async()=>{const v=await $("plates");n(v)})(),g()},[]);const[f]=m.useForm(),{mode:c}=F();return e.jsxs(m,{className:c==="light"?"light-theme":"dark-theme",form:f,...lt,name:"basic",initialValues:{remember:!0,name:"new",diameter:.5,length_xD:10,deep_of_drill:10,key:"newKey",company:"newCompany",is_broken:!1,storage:"newStorage",description:"hello"},onFinish:async g=>{g.images=a;try{console.log(g);const y=await r(g);console.log("Result: ",y),t()}catch(y){alert(`Возникла ошибка при отправке формы: ${(y==null?void 0:y.message)??"Неизвестная ошибка"}`)}},children:[e.jsx(m.Item,{label:"Название",name:"name",rules:[{required:!0,message:"Пожалуйста, введите название!"}],children:e.jsx(w,{placeholder:"Пожалуйста, введите название"})}),e.jsx(m.Item,{label:"Диаметр",name:"diameter",rules:[{required:!0,message:"Пожалуйста, введите диаметр!"}],children:e.jsx(w,{type:"number",placeholder:"Пожалуйста, введите диаметр"})}),e.jsx(m.Item,{label:"Длина",name:"length_xD",rules:[{required:!0,message:"Пожалуйста, введите длину!"}],children:e.jsx(w,{type:"number",placeholder:"Пожалуйста, введите длину"})}),e.jsx(m.Item,{label:"Глубина сверления",name:"deep_of_drill",rules:[{required:!0,message:"Пожалуйста, введите глубину сверления!"}],children:e.jsx(w,{type:"number",placeholder:"Пожалуйста, введите глубину сверления"})}),e.jsx(m.Item,{label:"Ключ",name:"key",rules:[{required:!0,message:"Пожалуйста, введите название ключа!"}],children:e.jsx(w,{placeholder:"Пожалуйста, введите название ключа"})}),e.jsx(m.Item,{label:"Компания",name:"company",rules:[{required:!0,message:"Пожалуйста, введите название компании!"}],children:e.jsx(w,{placeholder:"Пожалуйста, введите название компании"})}),e.jsx(m.Item,{label:"Состояние",name:"is_broken",rules:[{required:!0,message:"Пожалуйста, выберите состояние!"}],children:e.jsxs(b,{style:{width:"100%"},children:[e.jsx(b.Option,{value:!1,children:"Исправно"}),e.jsx(b.Option,{value:!0,children:"Сломанно"})]})}),e.jsx(m.Item,{label:"Винты",name:"screws",rules:[{required:!0,message:"Пожалуйста, выберите винт!"}],children:e.jsx(b,{mode:"multiple",style:{width:"100%"},placeholder:"Выберите винт...",children:s.map(g=>e.jsx(b.Option,{value:g.id,children:g.type},g.id))})}),e.jsx(m.Item,{label:"Пластины",name:"plates",rules:[{required:!0,message:"Пожалуйста, выберите винт(ы)!"}],children:e.jsx(b,{mode:"multiple",style:{width:"100%"},placeholder:"Выберите пластину...",children:o.map(g=>e.jsx(b.Option,{value:g.id,children:g.type},g.id))})}),e.jsx(m.Item,{label:"Место хранения",name:"storage",rules:[{required:!0,message:"Пожалуйста, выберите место хранения!"}],children:e.jsx(w,{placeholder:"Пожалуйста, выберите место хранения"})}),e.jsx(m.Item,{label:"Изображение",name:"images",children:e.jsx(pe,{fileList:a,onChange:l,children:e.jsx(k,{icon:e.jsx(ge,{}),children:"Нажмите, чтобы загрузить"})})}),e.jsx(m.Item,{label:"Описание",name:"description",rules:[{required:!0,message:"Пожалуйста, предоставьте описание!"}],children:e.jsx(w.TextArea,{rows:4,placeholder:"Пожалуйста, введите подробное описание"})}),e.jsx(m.Item,{...ct,children:e.jsx(k,{type:"primary",htmlType:"submit",children:"Отправить"})})]})}const ht=()=>{const[r,t]=u.useState(!1),s=()=>{t(!0)},i=()=>{t(!1)},o=()=>{t(!1),j.getDetails("drills")},{mode:n}=F();return e.jsxs(e.Fragment,{children:[e.jsx(k,{type:"primary",onClick:s,children:"Добавить сверло"}),e.jsx(ue,{className:n==="light"?"light-theme":"dark-theme",title:"Добавление сверла",open:r,footer:null,onCancel:i,children:e.jsx(dt,{onSubmit:rt,onSuccess:o})})]})},mt=({openFilter:r,activeItems:t})=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},children:[e.jsx(k,{type:"primary",onClick:r,children:"Фильтры"}),t!=="archive_drills"&&e.jsx(ht,{})]}),ut=({closeFilterDrawer:r,drawerVisible:t,setSelectedParameters:s,selectedParameters:i,resetFilter:o})=>{const{mode:n}=F(),a=W().pathname.slice(1),[p,l]=u.useState([]);return u.useEffect(()=>{t&&(async()=>{await j.getDetails(a);const c=j.getDetailsParameters(a);if(Array.isArray(c)){const g=Array.from(new Set(c.filter(y=>y!==void 0)));l(g.map(y=>({label:`${y} мм`,value:y})))}else l([]);t&&s(i)})()},[a,t,i,s]),e.jsx(Ue,{title:"Фильтрация по диаметрам",placement:"right",onClose:r,open:t,className:n==="light"?"light-theme":"dark-theme",children:e.jsxs("div",{children:[a==="drills"&&e.jsxs("label",{children:["Показать сломанные",e.jsx(Fe,{checked:j.isBroken,onChange:()=>j.handleIsBroken()})]}),e.jsx("h3",{children:"Выберите диаметры:"}),e.jsx(Ve.Group,{options:p,onChange:s,value:i,style:{display:"flex",flexDirection:"column"}}),e.jsxs("div",{style:{marginTop:"10px",display:"flex",justifyContent:"space-between"},children:[e.jsx(k,{onClick:o,children:"Сброс"}),e.jsx(k,{type:"primary",onClick:r,children:"Применить фильтр"})]})]})})},Q={title:"Изображение",dataIndex:"image_path",render:r=>{if(!r)return e.jsx(ee,{fontSize:"large"});const t=r.split(",")[0].trim(),s=`https://gas159.ru/api/${t}`;return e.jsx(e.Fragment,{children:t?e.jsx("img",{src:s,alt:"Изображение не найдено",style:{width:"50px",height:"50px",objectFit:"contain",border:"1px solid #e0e0e0"}}):e.jsx(ee,{fontSize:"large"})})}};function X(r,t){return{title:"Действия",render:(s,i)=>e.jsxs(e.Fragment,{children:[e.jsx(L,{edge:"start",color:"inherit",onClick:()=>r(i.id),children:e.jsx(Pe,{})}),e.jsx(L,{edge:"end",color:"inherit",onClick:()=>ot(i.id,t),children:e.jsx(Ee,{})})]})}}const H=r=>[{title:"ID",dataIndex:"id",sorter:(t,s)=>t.id-s.id,sortDirections:["ascend","descend"]},{title:"Название",dataIndex:"name",sorter:(t,s)=>t.name.toLowerCase().localeCompare(s.name.toLowerCase()),sortDirections:["ascend","descend"]},{title:"Диаметр",dataIndex:"diameter",sorter:(t,s)=>t.diameter-s.diameter,sortDirections:["ascend","descend"],render:(t,s)=>e.jsxs("span",{children:[s.diameter," мм"]})},{title:"Длинна",dataIndex:"length_xD",sorter:(t,s)=>t.length_xD-s.length_xD,sortDirections:["ascend","descend"]},{title:"Глубина сверления",dataIndex:"deep_of_drill",sorter:(t,s)=>t.deep_of_drill-s.deep_of_drill,sortDirections:["ascend","descend"]},{title:"Компания",dataIndex:"company",sorter:(t,s)=>t.company.toLowerCase().localeCompare(s.company.toLowerCase()),sortDirections:["ascend","descend"]},{title:"Винты",render:(t,s)=>{var i;return e.jsx("select",{defaultValue:"Винты",children:(i=s.screws)==null?void 0:i.map(o=>e.jsx("option",{children:o.type},o.id))})}},{title:"Пластины",render:(t,s)=>{var i;return e.jsx("select",{defaultValue:"Пластины",children:(i=s.plates)==null?void 0:i.map(o=>e.jsx("option",{children:o.type},o.id))})}},Q,X(r,"drills")],pt=r=>[{title:"ID",dataIndex:"id",sorter:(t,s)=>t.id-s.id,sortDirections:["ascend","descend"]},{title:"Тип",dataIndex:"type",sorter:(t,s)=>t.type.toLowerCase().localeCompare(s.type.toLowerCase()),sortDirections:["ascend","descend"]},{title:"Длина",dataIndex:"length",sorter:(t,s)=>t.length-s.length,sortDirections:["ascend","descend"],render:(t,s)=>e.jsxs("span",{children:[s.length," мм"]})},{title:"Резьба",dataIndex:"thread",sorter:(t,s)=>t.company.toLowerCase().localeCompare(s.company.toLowerCase()),sortDirections:["ascend","descend"]},{title:"Шаг резьбы",dataIndex:"step_of_thread",sorter:(t,s)=>t.step_of_thread-s.step_of_thread,sortDirections:["ascend","descend"]},{title:"Компания",dataIndex:"company",sorter:(t,s)=>t.company.toLowerCase().localeCompare(s.company.toLowerCase()),sortDirections:["ascend","descend"]},Q,X(r,"screws")],gt=r=>[{title:"ID",dataIndex:"id",sorter:(t,s)=>t.id-s.id,sortDirections:["ascend","descend"]},{title:"Тип",dataIndex:"sub_type",sorter:(t,s)=>t.type.toLowerCase().localeCompare(s.type.toLowerCase()),sortDirections:["ascend","descend"]},{title:"Материал",dataIndex:"material",sorter:(t,s)=>t.company.toLowerCase().localeCompare(s.company.toLowerCase()),sortDirections:["ascend","descend"]},{title:"Количество",dataIndex:"amount",sorter:(t,s)=>t.length-s.length,sortDirections:["ascend","descend"]},{title:"Компания",dataIndex:"company",sorter:(t,s)=>t.company.toLowerCase().localeCompare(s.company.toLowerCase()),sortDirections:["ascend","descend"]},Q,X(r,"plates")],xt=R(()=>{const[r,t]=u.useState(!1),[s,i]=u.useState([]),[o,n]=u.useState(!1),a=W().pathname.slice(1),p=_();u.useEffect(()=>{(async()=>{await j.getDetails(a),j.isError&&p("/error")})(),i([])},[a,p]);const l=h=>{j.getDetailIdEdit(h),n(!0)},f=()=>{n(!1)};let c=H(l);const g=s.length?j.details.filter(h=>{if(h.diameter)return s.includes(h.diameter);if(h.length)return s.includes(h.length);if(h.amount)return s.includes(h.amount)}):j.details;switch(a){case"drills":c=H(l);break;case"screws":c=pt(l);break;case"plates":c=gt(l);break;case"archive_drills":c=H(l);break}const y=()=>{t(!0)},v=()=>{t(!1)},M=()=>{i([]),t(!1)},U=(h,P)=>{console.log("params",h,P)},{mode:V}=F();return e.jsxs(e.Fragment,{children:[e.jsx(mt,{openFilter:y,activeItems:a}),s.length>0&&e.jsxs("div",{style:{marginBottom:"5px"},children:[e.jsx("h4",{children:"Применённые фильтры:"}),s.map(h=>e.jsxs(He,{color:"blue",style:{marginRight:"5px"},children:[h," мм"]},h)),e.jsx(k,{type:"link",onClick:M,children:"Сбросить фильтры"})]}),e.jsx(Ge,{className:V==="light"?"light-theme":"dark-theme",rowKey:"id",columns:c,dataSource:g,onChange:U,scroll:{x:1e3,y:55*5},pagination:!1,onRow:h=>({onClick:()=>{j.getDetailIdDescription(h.id)},style:{cursor:"pointer"}})}),e.jsx(ut,{closeFilterDrawer:v,drawerVisible:r,setSelectedParameters:i,selectedParameters:s,resetFilter:M}),e.jsx(at,{id:j.idDetailEdit,activeItem:a,visible:o,onClose:f})]})}),jt=({item:r})=>e.jsx(e.Fragment,{children:e.jsxs(C,{sx:{flex:1,mr:{sm:2,xs:0},mb:{xs:2,sm:0}},children:[e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["ID: ",r.id]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Название: ",r.name]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Диаметр: ",r.diameter]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Длина: ",r.length_xD]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Глубина сверления: ",r.deep_of_drill]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Компания: ",r.company]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Описание: ",r.description]})]})}),ft=({item:r})=>e.jsx(e.Fragment,{children:e.jsxs(C,{sx:{flex:1,mr:{sm:2,xs:0},mb:{xs:2,sm:0}},children:[e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["ID: ",r.id]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Тип: ",r.type]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Длина: ",r.length]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Резьба: ",r.thread]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Шаг резьбы: ",r.step_of_thread]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Компания: ",r.company]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Описание: ",r.description]})]})}),yt=({item:r})=>e.jsx(e.Fragment,{children:e.jsxs(C,{sx:{flex:1,mr:{sm:2,xs:0},mb:{xs:2,sm:0}},children:[e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["ID: ",r.id]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Тип: ",r.type]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Материал: ",r.material]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Количество: ",r.amount]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Компания: ",r.company]}),e.jsxs(d,{gutterBottom:!0,sx:{fontSize:14},children:["Описание: ",r.description]})]})}),wt=R(()=>{const[r,t]=u.useState(null),[s,i]=u.useState(!0),[o,n]=u.useState(0),a=W().pathname.slice(1);if(u.useEffect(()=>{const c=async()=>{i(!0);const g=await ye(j.idDetailDescription,a.slice(0,-1));g&&t(g),i(!1)};j.idDetailDescription!==null&&c()},[j.idDetailDescription]),s)return e.jsx("div",{children:"Loading..."});if(r===null)return e.jsx("div",{children:"Выберите строку"});const p=r.image_path?r.image_path.split(",").map(c=>c.trim()):[],l=()=>{n(c=>c===0?p.length-1:c-1)},f=()=>{n(c=>c===p.length-1?0:c+1)};return e.jsx("div",{children:e.jsx(me,{sx:{minWidth:275,padding:2,mt:4},children:e.jsxs(C,{display:"flex",flexDirection:{xs:"column",sm:"row"},children:[a==="drills"||a==="archive_drills"?e.jsx(jt,{item:r}):a==="screws"?e.jsx(ft,{item:r}):a==="plates"?e.jsx(yt,{item:r}):e.jsx("div",{children:"Неверный тип данных"}),e.jsxs(C,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[e.jsx(C,{sx:{display:"flex",justifyContent:"center",alignItems:"center",maxWidth:"100%",mb:1},children:e.jsx("img",{src:`https://gas159.ru/api/${p[o]}`,alt:"Изображение не найдено",style:{height:"auto",width:"100%",maxWidth:"200px",border:"2px solid rgb(224, 224, 224)",borderRadius:"4px"}})}),e.jsx(C,{sx:{fontSize:"14px",color:"gray"},children:`${o+1}/${p.length}`}),e.jsxs(C,{display:"flex",justifyContent:"center",alignItems:"center",children:[e.jsx(L,{onClick:l,disabled:o===0,children:e.jsx($e,{})}),e.jsx(L,{onClick:f,disabled:o===p.length-1,children:e.jsx(Me,{})})]})]})]})})})}),O=()=>e.jsxs("div",{children:[e.jsx(J,{}),e.jsx(fe,{}),e.jsxs(T,{children:[e.jsx(xt,{}),e.jsx(wt,{})]})]}),bt=()=>{const r=_(),{email:t,logout:s}=je(),i=()=>{s(),r("/")};return e.jsxs(e.Fragment,{children:[e.jsx(J,{}),e.jsxs(T,{children:[e.jsx(d,{variant:"h4",gutterBottom:!0,sx:{textAlign:"center",mt:4},children:"Личный кабинет"}),e.jsxs(me,{sx:{maxWidth:345,m:2},children:[e.jsx(qe,{avatar:e.jsx(Oe,{alt:"Ted talk"}),title:`User name: ${t}`,subheader:"Role"}),e.jsx(ze,{children:e.jsx(I,{variant:"contained",color:"primary",onClick:i,children:"Logaut"})})]})]})]})},Ct=()=>{const r=_(),t=()=>{r("/")};return e.jsx(T,{sx:{textAlign:"center",marginTop:"50px"},children:e.jsxs(C,{children:[e.jsx(d,{variant:"h4",gutterBottom:!0,children:"Ведутся технические работы"}),e.jsx(d,{variant:"body1",gutterBottom:!0,children:"Мы скоро вернемся. Попробуйте обновить страницу позже."}),e.jsx(I,{variant:"contained",color:"primary",onClick:t,children:"На главную"})]})})},Dt=()=>{const r=_(),t=()=>{r("/")};return e.jsxs(T,{style:{textAlign:"center",marginTop:"50px"},children:[e.jsx(d,{variant:"h4",gutterBottom:!0,children:"Страница не найдена"}),e.jsx(I,{variant:"contained",color:"primary",onClick:t,children:"На главную"})]})},St=()=>{const{theme:r}=F();return e.jsxs(Ne,{theme:r,children:[e.jsx(Re,{}),e.jsx(Se,{children:e.jsxs(We,{children:[e.jsx(D,{path:"/",element:e.jsx(st,{})}),e.jsx(D,{path:"/register",element:e.jsx(Ye,{})}),e.jsx(D,{path:"/login",element:e.jsx(Qe,{})}),e.jsx(D,{path:"/drills",element:e.jsx(O,{})}),e.jsx(D,{path:"/screws",element:e.jsx(O,{})}),e.jsx(D,{path:"/plates",element:e.jsx(O,{})}),e.jsx(D,{path:"archive_drills",element:e.jsx(O,{})}),e.jsx(D,{path:"/account",element:e.jsx(bt,{})}),e.jsx(D,{path:"/error",element:e.jsx(Ct,{})}),e.jsx(D,{path:"*",element:e.jsx(Dt,{})})]})})]})},z=S.create({withCredentials:!0,baseURL:"https://gas159.ru/api/"});z.interceptors.request.use(r=>(r.headers.Authorization=`Bearer ${localStorage.getItem("token")}`,r));class G{static async login(t,s){const i=new URLSearchParams;return i.append("username",t),i.append("password",s),z.post("auth/jwt/login",i,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}static async registration(t,s){return z.post("auth/register",{email:t,password:s})}static async logout(){return z.post("auth/jwt/logout")}}class It{constructor(){this.user={},this.isAuth=!1,this.isLoading=!1,K(this)}setAuth(t){this.isAuth=t}setUsers(t){this.user=t}setLoading(t){this.isLoading=t}async login(t,s){try{const i=await G.login(t,s);console.log(i),localStorage.setItem("token",i.data.accessToken),this.setAuth(!0),this.setUsers(i.data.user)}catch(i){console.log(i)}}async registration(t,s){try{const i=await G.registration(t,s);console.log(i),localStorage.setItem("token",i.data.accessToken),this.setAuth(!0),this.setUsers(i.data.user)}catch(i){console.log(i)}}async logout(){try{const t=await G.logout();console.log(t),localStorage.removeItem("token"),this.setAuth(!1),this.setUsers({})}catch(t){console.log(t)}}async checkAuth(){this.setLoading(!0);try{const t=await S.get("https://gas159.ru/api//refresh",{withCredentials:!0});console.log(t),localStorage.setItem("token",t.data.accessToken),this.setAuth(!0),this.setUsers(t.data.user)}catch(t){console.log(t)}finally{this.setLoading(!1)}}}const we=new It,kt=u.createContext({regStore:we});De(document.getElementById("root")).render(e.jsx(et,{children:e.jsx(kt.Provider,{value:{regStore:we},children:e.jsx(St,{})})}));
