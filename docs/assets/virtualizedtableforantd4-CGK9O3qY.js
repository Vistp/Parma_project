import{r as i}from"./react-DHBI0EtI.js";function S(e){"@babel/helpers - typeof";return S=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},S(e)}var x=["style","context"],ee=["ctx"];function K(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),o.push.apply(o,t)}return o}function L(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?K(Object(o),!0).forEach(function(t){te(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):K(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function te(e,r,o){return r=re(r),r in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}function re(e){var r=ne(e,"string");return S(r)==="symbol"?r:String(r)}function ne(e,r){if(S(e)!=="object"||e===null)return e;var o=e[Symbol.toPrimitive];if(o!==void 0){var t=o.call(e,r||"default");if(S(t)!=="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function $(e,r){if(e==null)return{};var o=oe(e,r),t,a;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],!(r.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function oe(e,r){if(e==null)return{};var o={},t=Object.keys(e),a,l;for(l=0;l<t.length;l++)a=t[l],!(r.indexOf(a)>=0)&&(o[a]=e[a]);return o}function b(){return b=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t])}return e},b.apply(this,arguments)}var ae=0,B=1,W=2,q=8,E=64,D=0,J=1,v;(function(e){e[e.INIT=1]="INIT",e[e.LOADED=2]="LOADED",e[e.RUNNING=4]="RUNNING"})(v||(v={}));function fe(){return{vt_state:v.INIT,possible_hight_per_tr:-1,computed_h:0,re_computed:0,row_height:[],row_count:0,prev_row_count:0,_offset_top:0,_offset_head:0,_offset_tail:1,WH:0,top:0,left:0,evt:ae,end:!1,final_top:0,f_final_top:J,update_count:0,indexMap:new WeakMap,HND_PAINT:0,retry_count:5}}function T(e,r){if(e.debug){if(r[0]==="+")return console.debug(r.slice(1));var o=new Date,t="".concat(o.toLocaleTimeString(),".").concat(o.getMilliseconds());console.debug("%c[".concat(e.id,"][").concat(t,"][").concat(r,"]"),"color:#a00",e)}}var ie=i.forwardRef(function(r,o){return i.createElement("table",b({ref:o},r))});function le(e){return i.createElement("tbody",e)}var ce=i.forwardRef(function(r,o){return i.createElement("tr",b({ref:o},r))});function se(e,r){var o=e.row_height,t=e.row_count,a=e.overscanRowCount;e._scroll_y=e.scroll.y,typeof e._scroll_y=="number"?e._y=e._scroll_y:(typeof e._scroll_y=="string"||console.assert(!1,"VT: did you forget to set `scroll.y`?"),e._y=e.wrap_inst.current.parentElement.offsetHeight),console.assert(e._y>=0);var l=0,c=0,f=0,s=0;if(r===-1&&t>0){for(c=t;c>0&&s<e._y;)s+=o[--c];return[0|c,0|t,0|e.computed_h-s]}for(;c<t&&l<r;++c)l+=o[c];for(f=c;f<t&&s<e._y;++f)s+=o[f];for(var p=a<0?0:a;c>0&&p--;)l-=o[--c];return f+=a,f>t&&(f=t),[0|c,0|f,0|l]}function Q(e,r,o,t){e._offset_top=0|r,e._offset_head=0|o,e._offset_tail=0|t}function ue(e,r,o,t,a){e.top=r,e.left=o,e.evt=t,e.end=a}function z(e,r,o){if(e.wrap_inst.current){var t=e.wrap_inst.current.parentElement;t.scrollTop=r,t.scrollLeft=Math.max(o,t.scrollLeft)}}function H(e){if(!e.HND_PAINT){var r=e.cq,o=e.wrap_inst,t=function(){e.HND_PAINT=0;for(var l=0;l<r.length;++l)r[l].index>=e._offset_head&&r[l].index<e._offset_tail&&r[l].func();if(!(e.vt_state!==v.RUNNING||!o.current)){var c=e.computed_h;if(e.WH!==c){e.WH=c;var f=o.current.style;f.height=c?(f.maxHeight=c+"px",f.maxHeight):(f.maxHeight="unset",f.maxHeight),e.on_update_wrap_style()}}};e.HND_PAINT=e.evt===q?window.requestAnimationFrame(t):window.setTimeout(t)}}function X(e,r,o,t){var a=r-o,l=new Array(a).fill(t);e.row_height=e.row_height.concat(l),e.computed_h+=a*t}function _e(e,r,o){if(r===0){e.computed_h=0,e.row_height.length=0,e.top=0;return}for(var t=e.row_height,a=0,l=r;l<o;++l)a+=t[l];e.computed_h-=a}function pe(e,r){e.re_computed=r-e.row_count,e.prev_row_count=e.row_count,e.row_count=r}var ve=function(r,o){var t=r.style,a=r.context,l=$(r,x),c=i.useState(0),f=i.useRef(function(){}),s,p=i.useMemo(function(){return i.createRef()},[]),n=i.useContext(a);i.useMemo(function(){Object.assign(n,fe()),n.wrap_inst&&n.wrap_inst.current&&n.wrap_inst.current.parentElement.removeEventListener("scroll",s),n.wrap_inst=p,n.top=n.initTop,n.on_update_wrap_style=function(){n._y===0&&"".concat(n._scroll_y).length&&s({flag:E,target:{scrollTop:n.top,scrollLeft:n.left}})},n.cq=[];var _=0,m=0;n.cq.push=function(u){if(n.vt_state===v.RUNNING){var h=n._offset_tail-n._offset_head+n.overscanRowCount*2+10;return m=Math.max(m,h),_>m&&(_=0),n.cq[_++]=u,0}}},[]);var g=i.useRef([]).current,d;s=i.useCallback(function(_){if(n.vt_state===v.RUNNING){var m=performance.now();if(_){if("flag"in _)g.push(_);else{var u=_.target,h=Math.max(u.scrollTop,0);g.push({target:{scrollTop:h,scrollLeft:u.scrollLeft},end:Math.abs(u.scrollHeight-u.clientHeight-Math.round(h))<=(n.offset||0),flag:q})}if(n.f_final_top===D)return d(m)}n.HND_RAF||(n.HND_RAF=window.setTimeout(function(){return Promise.resolve().then(function(){return d(m)})}))}},[]),d=i.useCallback(function(_){n.HND_RAF=0;var m=performance.now();if(m-_>10&&n.retry_count-- >0){s();return}if(n.retry_count=5,n.vt_state===v.RUNNING){var u=g,h;if(u.length){h=u.pop(),u.length=0;var w=h.target.scrollTop,A=h.target.scrollLeft,F=h.flag;T(n,"top: ".concat(w,", left: ").concat(A));var M=se(n,n.f_final_top===D?n.final_top:w),P=M[0],C=M[1],I=M[2],j=n._offset_head,k=n._offset_tail,V=n._offset_top,U=!1;switch(F){case B:T(n,"SCROLLEVT_INIT");break;case E:T(n,"SCROLLEVT_BY_HOOK"),P===j&&C===k&&I===V?(n.f_final_top=J,n.final_top===-1&&(w=n.computed_h-n._y),U=!0):n.final_top===-1&&(w=I);break;case W:if(P===j&&C===k&&I===V)return;T(n,"SCROLLEVT_RECOMPUTE");break;case q:if(P===j&&C===k&&I===V)return;T(n,"SCROLLEVT_NATIVE"),n.onScroll&&n.onScroll({top:w,left:A,isEnd:h.end}),U=h.end;break}Q(n,I,P,C),ue(n,w,A,F,U),c[1](++n.update_count)}}},[]),i.useImperativeHandle(o,function(){var _=function(u){n.f_final_top=D,n.final_top=u,s({target:{scrollTop:u,scrollLeft:-1},flag:E})};return{scrollTo:function(u){f.current=function(){return _(u)},f.current()},scrollToIndex:function(u){f.current=function(){u>n.row_count-1&&(u=n.row_count-1),u<0&&(u=0);for(var h=0,w=0;w<u;++w)h+=n.row_height[w];_(h)},f.current()}}},[]),i.useEffect(function(){var _=p.current.parentElement;try{_.addEventListener("scroll",s,{passive:!0})}catch{_.addEventListener("scroll",s,!1)}},[p.current]),i.useEffect(function(){s({flag:E,target:{scrollLeft:n.left,scrollTop:n.top}})},[n.scroll.y]),i.useEffect(function(){switch(n.evt){case E:n.f_final_top===D?f.current():z(n,n.top,n.left);break;case B:case W:z(n,n.top,n.left);break}},[c[0]]),i.useEffect(function(){switch(n.vt_state){case v.LOADED:n.vt_state=v.RUNNING,s({target:{scrollTop:n.top,scrollLeft:0},flag:E});break;case v.RUNNING:n.re_computed!==0&&(n.re_computed=0,s({target:{scrollTop:n.top,scrollLeft:n.left},flag:W}));break}});var O=i.useMemo(function(){return{width:t.width,minWidth:"100%",position:"relative",transform:"translate(0)"}},[t.width]),N=i.useMemo(function(){return L(L({},t),{},{width:void 0,position:"relative",top:n._offset_top,transform:"translate(0)"})},[n._offset_top]),y=i.useMemo(function(){return L({},n)},[n.update_count]),R=n.components.table;return i.createElement("div",{ref:p,style:O},i.createElement(a.Provider,{value:y},i.createElement(R,b({},l,{style:N}))))},he=function(r){var o=r.children,t=r.className,a=r.ctx,l=o[0],c=o[1],f=Array.isArray(c)?c.length:0,s=a._offset_head,p=a._offset_tail,n=[];switch(a.vt_state){case v.INIT:f>=0&&(console.assert(s===0),console.assert(p===1),Array.isArray(c)?(n=c.slice(s,p),a.indexMap.set(n[0].props.record,0)):n=c,a.re_computed=f,a.prev_row_count=f,a.row_count=f);break;case v.RUNNING:{if(p>f){var g=p-f;p-=g,s-=g,s<0&&(s=0),p<0&&(p=0),Q(a,a._offset_top,s,p)}a.row_count!==f&&pe(a,f),f=a.row_count;var d=a.prev_row_count;if(f<d)_e(a,f,d);else if(f>d){var O=a.row_height;f-O.length>0?X(a,f,d,a.possible_hight_per_tr):(O.fill(a.possible_hight_per_tr,d,f),a.computed_h+=a.possible_hight_per_tr*(f-d))}if(f){var N=s;n=c.slice(N,p),n.forEach(function(R){return a.indexMap.set(R.props.record,N++)})}else n=c;a.prev_row_count=a.row_count}break;case v.LOADED:console.assert(!1);break}var y=a.components.body.wrapper;return i.createElement(y,{className:t},l,n)},de=function(r){var o=i.createRef(),t=r.ctx,a=$(r,ee),l=r.children,c=t.components.body.row;if(!Array.isArray(l))return i.createElement(c,a,l);var f=l[0].props,s=t.indexMap.get(f.record),p=i.useRef(s),n=i.useMemo(function(){return".".concat(f.prefixCls,"-expanded-row")},[f.prefixCls]),g=performance.now();return i.useLayoutEffect(function(){var d=performance.now();return T(t,"+idx ".concat(s," tooks ").concat(d-g," ms")),t.vt_state===v.RUNNING?H(t):(t.possible_hight_per_tr=o.current.offsetHeight,X(t,t.row_count,0,t.possible_hight_per_tr),H(t),t.vt_state=v.LOADED),function(){H(t)}},[]),i.useEffect(function(){t.cq.push({index:s,func:function(){var O=o.current;if(O){for(var N=O.offsetHeight,y=O.nextSibling;y&&y.matches(n);)N+=y.offsetHeight,y=y.nextSibling;var R=t.row_height[s],_=t.row_height[p.current];t.computed_h-=R,t.computed_h+=_,t.computed_h+=N-_,t.row_height[s]=N}}}),H(t)}),i.createElement(c,b({},a,{ref:o}))};function Z(e,r){var o=r.table,t=r.body,a=r.header;e.components.body=L(L({},e.components.body),t),t&&t.cell&&(e._vtcomponents.body.cell=t.cell),a&&(e.components.header=a,e._vtcomponents.header=a),o&&(e.components.table=o)}function me(e,r){var o=i.useRef(i.createContext({})).current,t=i.useContext(o),a=i.useRef({scrollTo:function(c){},scrollToIndex:function(c){}});return i.useMemo(function(){return Object.assign(t,{id:(+new Date).toString(36).slice(4),initTop:0,overscanRowCount:5,debug:!1,ref:a},e())},r),i.useMemo(function(){var l=i.forwardRef(ve);t._vtcomponents={table:function(f){return i.createElement(l,b({},f,{context:o,ref:t.ref}))},body:{wrapper:function(f){return i.createElement(o.Consumer,null,function(){return i.createElement(he,b({},f,{ctx:t}))})},row:function(f){return i.createElement(de,b({},f,{ctx:t}))}}},t.components={},Z(t,{table:ie,body:{wrapper:le,row:ce}}),t.vt_state=v.INIT},[]),t}function G(e){"@babel/helpers - typeof";return G=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},G(e)}var Y=1,we=2;(function(){var e=(typeof window>"u"?"undefined":G(window))==="object"&&window instanceof Window?Y:we;if(e&Y&&!Object.hasOwnProperty.call(window,"requestAnimationFrame")&&!window.requestAnimationFrame)throw new Error("Please using the modern browers or appropriate polyfill!")})();function be(e,r){var o=me(e,r||[]);return[o._vtcomponents,function(t){return Z(o,t)},o.ref]}export{be as u};
